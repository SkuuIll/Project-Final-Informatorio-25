# Docker Compose simplificado para desarrollo
services:
  # Solo la aplicaciÃ³n Django con SQLite
  web:
    build: .
    command: >
      sh -c "python manage.py migrate &&
             python manage.py collectstatic --noinput &&
             python manage.py runserver 0.0.0.0:8000"
    volumes:
      - .:/app
      - static_volume:/app/staticfiles
      - media_volume:/app/media
    ports:
      - "8000:8000"
    environment:
      - DEBUG=True
      - USE_POSTGRESQL=False
      - SECRET_KEY=${SECRET_KEY}
      - GOOGLE_API_KEY=${GOOGLE_API_KEY}
      - TURNSTILE_SITE_KEY=${TURNSTILE_SITE_KEY}
      - TURNSTILE_SECRET_KEY=${TURNSTILE_SECRET_KEY}
      - GEMINI_TEXT_MODEL=${GEMINI_TEXT_MODEL}
      - GEMINI_IMAGE_MODEL=${GEMINI_IMAGE_MODEL}
      - DEFAULT_IMAGE_SERVICE=${DEFAULT_IMAGE_SERVICE}
      - COVER_IMAGE_FOLDER=${COVER_IMAGE_FOLDER}
      - MAX_IMAGE_SIZE_MB=${MAX_IMAGE_SIZE_MB}
      - IMAGE_COMPRESSION_QUALITY=${IMAGE_COMPRESSION_QUALITY}
      - SENTRY_DSN=${SENTRY_DSN}
    restart: unless-stopped

volumes:
  static_volume:
  media_volume: